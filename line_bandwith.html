<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://highcharts.github.io/export-csv/export-csv.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
 
</head>
<center>
    <div id="2020_05_Sterblichkeit_TG_0_64_65plus_2020" style="max-width: 800px; height: 550px"></div>

 <pre id="csv_0_64_65plus" style="display:none">date,untere Grenze 0-64,Erwartung 0-64,obere Grenze 0-64,Anzahl Todesfälle 0-64,untere Grenze 65plus,Erwartung 65plus,obere Grenz e 65plus,Anzahl Todesfälle 65plus
2020/1/5,0,6,12,7,22,38,54,24
2020/1/12,0,6,12,7,22,38,54,38
2020/1/19,0,6,12,3,22,38,54,30
2020/1/26,0,6,12,0,23,38,54,37
2020/2/2,0,6,12,4,22,38,54,36
2020/2/9,0,6,12,8,22,38,54,42
2020/2/16,0,6,12,6,22,38,54,37
2020/2/23,0,6,12,7,22,38,54,26
2020/3/1,0,6,12,7,22,38,54,33
2020/3/8,0,6,12,9,22,37,53,23
2020/3/15,0,6,12,7,21,37,52,38
2020/3/22,0,6,12,5,21,36,51,35
2020/3/29,0,6,12,8,20,35,50,37
2020/4/5,0,6,12,11,19,34,49,34
2020/4/12,0,6,12,3,19,33,48,39
2020/4/19,0,6,12,12,18,33,47,35
2020/4/26,0,6,12,5,18,32,47,35
2020/5/3,0,6,12,4,17,32,46,36
2020/5/10,0,6,12,5,17,31,46,24
2020/5/17,0,6,12,4,17,31,46,27
2020/5/24,0,6,12,6,17,31,45,21
2020/5/31,0,6,12,5,16,31,45,24
2020/6/7,0,6,12,4,16,31,45,29
2020/6/14,0,6,12,3,16,30,45,21
2020/6/21,0,6,12,6,16,30,45,22
2020/6/28,0,6,12,6,16,30,44,33
2020/7/5,0,6,12,3,16,30,44,29
2020/7/12,0,6,12,5,16,30,44,37
2020/7/19,0,6,12,6,16,30,44,27
2020/7/26,0,6,12,3,16,30,44,32
2020/8/2,0,6,12,8,16,30,44,34
2020/8/9,0,6,12,3,16,30,44,36
2020/8/16,0,6,12,3,16,30,45,33
2020/8/23,0,6,12,4,16,31,45,25
2020/8/30,0,6,12,5,17,31,45,29
2020/9/6,0,6,12,8,17,31,46,33
2020/9/13,0,6,12,4,17,32,46,41
2020/9/20,0,6,12,3,18,32,47,25
2020/9/27,0,6,12,2,18,33,47,29
2020/10/4,0,6,12,8,18,33,48,32
2020/10/11,0,6,12,8,18,33,48,27
2020/10/18,0,6,12,5,19,34,48,29
2020/10/25,0,6,12,10,19,34,49,50
2020/11/1,0,6,12,10,19,34,49,47
2020/11/8,0,6,12,7,19,34,49,60
2020/11/15,0,6,12,7,19,35,50,44
2020/11/22,0,6,12,6,20,35,50,50
2020/11/29,0,6,12,5,20,35,50,58
2020/12/6,0,6,12,10,20,35,50,51
2020/12/13,0,6,12,12,20,35,50,51
2020/12/20,0,6,12,5,20,35,51,72
2020/12/27,0,6,12,6.1,20,35,51,76.2
2021/1/3,0,6,12,1.1,20,36,51,72.3
2021/1/10,0,6,12,9,22,38,54,80.1
2021/1/17,0,6,12,7.1,22,38,54,82.6
2021/1/24,0,6,12,5.9,22,38,54,56.8


</pre>


</center>
<script>


function test(data) {
  var ranges_bis64 = [],
    averages_bis64 = [],
    current_bis64 = [],
    ranges_65plus = [],
    averages_65plus = [],
    current_65plus = [],
    lines = data.split('\n');

  for (i = 1; i < lines.length; i++) {
    var items = lines[i].split(',');

    ranges_bis64.push([new Date(items[0]).getTime(), +items[1], +items[3]]);
    averages_bis64.push([new Date(items[0]).getTime(), +items[2]]);
    current_bis64.push([new Date(items[0]).getTime(), +items[4]]);
    ranges_65plus.push([new Date(items[0]).getTime(), +items[5], +items[7]]);
    averages_65plus.push([new Date(items[0]).getTime(), +items[6]]);
    current_65plus.push([new Date(items[0]).getTime(), +items[8]]);
  }

$(document).ready(function() {
  var chart = {
    type: 'line',
    spacingBottom: 40,
    marginBottom: 130
  };

  var plotOptions = {
   	line: {
  		marker: {
      		enabled: false
   		},
    events: {
  		legendItemClick: function () {
      		return true; 
       		}
   		}
     },
     series: {
        events: {
          legendItemClick: function() {
            var name = this.name.substring(this.name.length - 4, this.name.length);
            var _i = this._i;
            Highcharts.each(this.chart.series, function(p, i) {
              if (name === p.name.substring(p.name.length - 4, p.name.length) && _i !== p._i) {
                (!p.visible) ? p.show(): p.hide()
              }
            })
          }
        }
      }
  };

  var title = {
    text: 'Die Zahl der Todesfälle bei den über 64-Jährigen liegt auch im Januar klar über den erwarteten Werten',
    style: {
      fontSize: '18px'
    },
    align: 'left'
  };

  var subtitle = {
    text: 'Wöchentliche Todesfälle und erwartete Todesfälle (graues Band) nach Altersgruppen, Kanton Thurgau, Jan 2020-Jan 2021',
    style: {
      fontSize: '12px'
    },
    align: 'left'
  };

  var yAxis = {
    gridLineWidth: 1,
    lineWidth: 1,
    min: 0,
    max: 90,
    title: ''
  };

  var xAxis = {
     tickWidth: 0,
     type: 'datetime',
     dateTimeLabelFormats: {
            day: '%e. %b',
        },
     labels: {
     	rotation: 0,
        step: 1
        }                
   };

 var series = [{
       name: 'Anzahl Todesfälle über 64-Jährige',
      data: current_65plus,
      color: '#660066',
      zIndex: 2,
      legendColor: '#660066',
      marker: {
        symbol: 'circle',
        enabled: false
      }   
    }, {
      name: 'Bandbreite über 64-Jährige',
      data: ranges_65plus,
      type: 'arearange',
      lineWidth: 0,
      linkedTo: ':previous',
      color: 'black',
      fillOpacity: 0.1,
      zIndex: 0,
      marker: {
        symbol: 'circle',
        enabled: false
      },
      visible: true,
      showInLegend: false,
      tooltip: {
      	enabled: false
        }
      },{ 	
      name: 'Anzahl Todesfälle 0- bis 64-Jährige',
      data: current_bis64,
      color: 'black',
      zIndex: 3,
      legendColor: 'black',
      marker: {
        symbol: 'circle',
        enabled: false
      },
      visible: false
    
    }, {
      name: 'Bandbreite 0- bis 64-Jährige',
      data: ranges_bis64,
      type: 'arearange',
      lineWidth: 0,
      linkedTo: ':previous',
      color: 'black',
      fillOpacity: 0.1,
      zIndex: 4,
      marker: {
        symbol: 'circle',
        enabled: false
      },
      visible: false,
      showInLegend: false,
      tooltip: {
      	enabled: false
        }
      	
      
    }];

    
  var tooltip = {
    shared: false,
    type: 'datetime',
    xDateFormat: '%d.%m.%Y',
    valueSuffix: "<span style='font-weight:normal;'>" + ' Personen' + "</span>"
  };
  
  
                    
  var legend = {
    enabled: true,
    layout: 'horizontal',
    align: 'center',
    verticalAlign: 'bottom',
    padding: 25,
    symbolPadding: 10,
    symbolWidth: 25,
    margin: -20,
    itemStyle: {
      fontWeight: 'normal'
    }
  };

  var credits = {
    text: '<span style="font-size: 12px; font-weight: bold; color: #27408B">Hinweis: Klicken Sie in der Legende die zweite Kategorie an, um die Daten für die 0- bis 64-jährige <br>Bevölkerung einzublenden.</span><br>Dienststelle für Statistik Kanton Thurgau <br>Datenquelle: Bundesamt für Statistik, Mortalitätsmonitoring (Stand: 2.02.2021)',
    href: false,
    style: {
      color: '#999999',
      cursor: false,
      fontSize: '11px'
    },
    position: {
      align: 'left',
      x: 10,
      y: -45
    }
  };

  var exporting = {
    allowHTML: true,
    enabled: true,
    filename: '2020_05_Sterblichkeit_TG_0_64_65plus_2020',
    buttons: {
      contextButton: {
        menuItems: "printChart separator downloadPNG downloadJPEG downloadSVG separator downloadXLS".split(" ")
      }
    },
    /*csv: {
        columnHeaderFormatter: function (item) {
        	if(item instanceof Highcharts.Axis) {
            	return 'Quartal';
            } else {
            	if(item instanceof Highcharts.Series) {
            		return item.name;
                }
            }
        }
    }*/
  };

  var highchartsOptions = Highcharts.setOptions({
    lang: {
      decimalPoint: '.',
      thousandsSep: "'",
      months: ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
      weekdays: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],
      shortMonths: ['Jan', 'Feb', 'Mrz', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
      contextButtonTitle: 'Drucken, Download, Export',
      downloadJPEG: 'Download JPEG Bild',
      downloadPNG: 'Download PNG Bild',
      downloadSVG: 'Download SVG Vektor Bild',
      downloadXLS: 'Download XLS',
      printChart: 'Bild drucken',
      viewData: 'Datentabelle ein-/ausblenden',
      resetZoom: "Zoom zurücksetzen",
      resetZoomTitle: "Zoom zurücksetzen",
      drillUpText: "Zurück",
      numericSymbols: null //otherwise by default ['k', 'M', 'G', 'T', 'P', 'E']
    },
      time: {
        useUTC: false
      }
  });

  var colors = ["#0064e6", "#00B4E8", "#FFED00", "#3CA433", "#0064e6", "#00B4E8", "#FFED00", "#3CA433", "#0064e6", "#00B4E8", "#FFED00", "#3CA433", "#0064e6", "#00B4E8", "#FFED00", "#3CA433", "#0064e6", "#00B4E8", "#FFED00", "#3CA433", "#0064e6", "#00B4E8", "#FFED00", "#3CA433", "#0064e6", "#00B4E8", "#FFED00", "#3CA433"]

  var json = {};
  json.chart = chart;
  json.plotOptions = plotOptions;
  json.title = title;
  json.subtitle = subtitle;
  json.yAxis = yAxis;
  json.xAxis = xAxis;
  json.tooltip = tooltip;
  json.series = series;
  json.legend = legend;
  json.colors = colors;
  json.credits = credits;
  json.exporting = exporting;
  json.highchartsOptions = highchartsOptions;

  $('#2020_05_Sterblichkeit_TG_0_64_65plus_2020').highcharts(json);
});
};
test(document.getElementById('csv_0_64_65plus').innerHTML);

  function addThousandsep(nStr) {
                               nStr += '';
                               x = nStr.split('.');
                               x1 = x[0];
                               x2 = x.length > 1 ? '.' + x[1] : '';
                               var rgx = /(\d+)(\d{3})/;
                               while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + "'" + '$2');
                               }
                               return x1 + x2;
                               }
</script>
